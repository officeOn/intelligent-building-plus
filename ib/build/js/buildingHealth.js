!function(){var t=t||{},e=e||{};e.ListItem=Backbone.Model.extend({defaults:function(){return{id:this.cid,name:"No-title",health:20}}}),e.List=Backbone.Collection.extend({url:"/back/index.php/health",model:e.ListItem,initialize:function(t){t.id&&(this.url="/back/index.php/zones/"+t.id+"/units")}}),t.Entry=Marionette.View.extend({template:"#buildingHealth-entry",regions:new RegionSetter("list","map"),initialize:function(t){},onRender:function(){this.getRegion("list").show(new t.List(this.options))},onChildviewShowMarker:function(e){this.getRegion("map").show(new t.Map({model:e}))}}),t.Map=Marionette.View.extend({template:"#t-map",map:null,className:"mini-map",initialize:function(t){this.model=t.model},onAttach:function(){console.log(this.model),"undefined"!=typeof L&&(console.warn(this.map),null!=this.map&&this.map.remove(),this.triggerMethod("init:map"))},onInitMap:function(){var t=this,e={scrollWheelZoom:!1};this.map=L.map(this.el,e),L.tileLayer("http://85.188.8.254/back/IB_floorplan_72.53mx72.53m/{z}/{x}/{y}.png",{attribution:'&copy; <a target="_blank" href="http://tieto.com">Tieto</a>',minZoom:1,maxZoom:6,continuousWorld:!1,tms:!0,noWrap:!0}).addTo(this.map),dataset=this.model.attributes;var i=this.model.get("coordinates"),o=_.template($("#t-list-map-popup").html())(dataset),n=_.sample(["marker-success","marker-warning","marker-danger"]),l=L.divIcon({className:"marker "+n}),a=L.latLngBounds([[-180,-180],[180,180]]);this.map.setMaxBounds(a),this.map.on("drag",function(){t.map.panInsideBounds(a,{animate:!0})});var s=L.marker(i,{icon:l}).bindPopup(o);this.map.addLayer(s),this.map.setView(i,2),this.map.on("click",function(t){console.log([t.latlng.lat,t.latlng.lng])})}}),t.ListItem=Marionette.View.extend({template:"#buildingHealth-listItem",className:"list-group-item-light",tagName:"li",regions:new RegionSetter("map","tools"),ui:{btnHolder:".btn-holder",btns:'[data-action="trigger"]',mapBtn:'[data-id="map"]',toolsBtn:'[data-id="tools"]',closeBtn:'[data-action="close"]'},triggers:{"click header":"toggle:buttons","click @ui.mapBtn":"show:map","click @ui.toolsBtn":"show:tools"},onToggleButtons:function(){this.$el.toggleClass("opened"),this.getUI("btnHolder").slideToggle(),this.triggerMethod("hide:regions")},onHideRegions:function(){this.getRegion("map").empty(),this.getRegion("tools").empty(),this.getUI("btns").removeClass("btn-fill")},onShowMap:function(){this.triggerMethod("hide:regions"),this.getUI("mapBtn").addClass("btn-fill"),this.getRegion("map").show(new t.Map({model:this.model}))},onShowTools:function(){this.triggerMethod("hide:regions"),this.getUI("toolsBtn").addClass("btn-fill"),this.getRegion("tools").show(new t.Tools({model:this.model}))}}),t.Tools=Marionette.View.extend({className:"list-group",template:"#buildingHealth-tools",initialize:function(t){this.model=t.model}}),t.List=Marionette.CollectionView.extend({className:"list-group",tagName:"ul",childView:t.ListItem,initialize:function(t){this.collection=new e.List(t),this.collection.fetch()},collectionEvents:{sync:"onSync"},onChildviewOpenMap:function(t){console.log(t.model);var e=t.model;this.triggerMethod("show:marker",e)},onSync:function(){console.log(this.collection.models),this.render()},onRender:function(){}}),window.module_buildingHealth={View:t,Data:e,Entry:t.Entry},console.log(window.module_buildingHealth)}();
//# sourceMappingURL=buildingHealth.js.map
