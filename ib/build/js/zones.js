!function(){var t=t||{},e=e||{};e.ZoneItem=Backbone.Model.extend({defaults:function(){return{id:this.cid,name:"No-title",health:20}}}),e.Zones=Backbone.Collection.extend({url:"/back/index.php/zones",model:e.ZoneItem}),t.Entry=Marionette.View.extend({template:"#zones-entry",regions:new RegionSetter("content"),events:{'click [data-action="trigger"]':"showContent",'click [data-action="back"]':"historyBack"},initialize:function(t){console.log(this,t)},historyBack:function(){app.router.navigate("",{trigger:!0})},onRender:function(){var n=this;this.zonesCollection=new e.Zones,this.zonesCollection.fetch(),this.zonesCollection.on("sync",function(e){n.getRegion("content").show(new t.Map({collection:e}))})},showContent:function(e){var n=e.currentTarget.dataset.id;"map"==n?view=new t.Map({collection:this.zonesCollection}):view=new t.List({collection:this.zonesCollection}),this.getRegion("content").show(view)}}),t.Map=Marionette.View.extend({template:"#t-map",map:null,className:"maxi-map",initialize:function(t){this.collection=t.collection},onBeforeAttach:function(){this.$el.on("click",'[data-action="navigate"]',function(t){var e=t.currentTarget.dataset.id,n="zones/"+e+"/units";app.router.navigate(n,{trigger:!0})})},onAttach:function(){console.log(this.collection),"undefined"!=typeof L&&(console.warn(this.map),null!=this.map&&this.map.remove(),this.triggerMethod("init:map"))},onInitMap:function(){var t=this,e={scrollWheelZoom:!1};this.map=L.map(this.el,e),L.tileLayer("http://85.188.8.254/back/IB_floorplan_72.53mx72.53m/{z}/{x}/{y}.png",{attribution:'&copy; <a target="_blank" href="http://tieto.com">Tieto</a>',minZoom:1,maxZoom:6,continuousWorld:!1,tms:!0,noWrap:!0}).addTo(this.map),this.map.setView([0,-100],1);var n=L.latLngBounds([[-180,-180],[180,180]]);this.map.setMaxBounds(n),this.map.on("drag",function(){t.map.panInsideBounds(n,{animate:!0})}),_.forEach(this.collection.models,function(e){var n=e.get("coordinates");if(n){dataset=e.attributes;var o=_.template($("#t-polygon-popup").html())(dataset),i=_.sample(["marker-success","marker-warning","marker-danger"]),a=(L.divIcon({className:"marker "+i}),_.random(10,100)),l=L.polygon(n,{color:"hsl("+a+",70%,50%)"}).bindPopup(o);t.map.addLayer(l)}}),this.map.on("click",function(t){console.log([t.latlng.lat,t.latlng.lng])})}}),t.ListItem=Marionette.View.extend({template:"#zones-listItem",className:"list-group-item-light",tagName:"li",regions:new RegionSetter("map","tools"),ui:{},triggers:{click:"open:units"},onOpenUnits:function(){zoneId=this.model.id;var t="zones/"+zoneId+"/units";app.router.navigate(t,{trigger:!0})}}),t.List=Marionette.CollectionView.extend({className:"list-group",tagName:"ul",childView:t.ListItem,initialize:function(t){this.collection=t.collection},onRender:function(){}}),window.module_zones={View:t,Data:e,Entry:t.Entry},console.log(window.module_zones)}();
//# sourceMappingURL=zones.js.map
