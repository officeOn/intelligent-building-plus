!function(){var e=e||{},t=t||{};t.ListItem=Backbone.Model.extend({defaults:function(){return{id:this.cid,name:"No-title",health:20,cleaningItems:["Mop"]}}}),t.List=Backbone.Collection.extend({model:t.ListItem,initialize:function(e){this.url="/back/index.php/zones/"+e.id+"/units"}}),e.Entry=Marionette.View.extend({template:"#units-entry",regions:new RegionSetter("list","map"),initialize:function(e){},onRender:function(){this.getRegion("list").show(new e.List(this.options))},onChildviewShowMarker:function(t){this.getRegion("map").show(new e.Map({model:t}))}}),e.Map=Marionette.View.extend({template:"#t-map",map:null,className:"mini-map",initialize:function(e){this.model=e.model},onAttach:function(){console.log(this.model),"undefined"!=typeof L&&(console.warn(this.map),null!=this.map&&this.map.remove(),this.triggerMethod("init:map"))},onInitMap:function(){var e=this,t={scrollWheelZoom:!1};this.map=L.map(this.el,t),L.tileLayer("http://85.188.8.254/back/IB_floorplan_72.53mx72.53m/{z}/{x}/{y}.png",{attribution:'&copy; <a target="_blank" href="http://tieto.com">Tieto</a>',minZoom:1,maxZoom:6,continuousWorld:!1,tms:!0,noWrap:!0}).addTo(this.map),dataset=this.model.attributes;var i=this.model.get("coordinates");_.isArray(i)||(i=[0,0]);var n=_.template($("#t-list-map-popup").html())(dataset),o=_.sample(["marker-success","marker-warning","marker-danger"]),l=L.divIcon({className:"marker "+o}),a=L.latLngBounds([[-180,-180],[180,180]]);this.map.setMaxBounds(a),this.map.on("drag",function(){e.map.panInsideBounds(a,{animate:!0})});var s=L.marker(i,{icon:l}).bindPopup(n);this.map.addLayer(s),this.map.setView(i,2),this.map.on("click",function(e){console.log([e.latlng.lat,e.latlng.lng])})}}),e.ListItemEmpty=Marionette.View.extend({template:_.template('<div class="alert alert-info">No data, please try again later</div>')}),e.ListItem=Marionette.View.extend({template:"#units-listItem",className:"list-group-item-light",tagName:"li",regions:new RegionSetter("map","info","refillable","cleanable"),ui:{btnHolder:".btn-holder",btns:'[data-action="trigger"]',mapBtn:'[data-id="map"]',toolsBtn:'[data-id="tools"]',closeBtn:'[data-action="close"]'},triggers:{"click header.main":"toggle:buttons","click @ui.mapBtn":"show:map","click @ui.toolsBtn":"show:info"},onToggleButtons:function(){this.$el.toggleClass("opened"),this.getUI("btnHolder").slideToggle(),this.triggerMethod("hide:regions"),this.$el.hasClass("opened")},onHideRegions:function(){this.getRegion("map").empty(),this.getRegion("info").empty(),this.getUI("btns").removeClass("btn-fill")},onShowMap:function(){this.triggerMethod("hide:regions"),this.getUI("mapBtn").addClass("btn-fill"),this.getRegion("map").show(new e.Map({model:this.model}))},onShowInfo:function(){this.triggerMethod("hide:regions"),this.getUI("toolsBtn").addClass("btn-fill"),this.getRegion("info").show(new e.Info({model:this.model}))}}),e.Info=Marionette.View.extend({template:"#Info",regions:new RegionSetter("cleanable","refillable"),initialize:function(e){this.model=e.model},onRender:function(){var t=new e.RefillableWrapper({id:this.model.id});this.getRegion("refillable").show(t);var i=new e.CleanableWrapper({id:this.model.id});this.getRegion("cleanable").show(i)}}),t.Cleanable=Backbone.Collection.extend({initialize:function(e){this.url="/back/index.php/units/"+e.id+"/cleanable"}}),e.CleanableItem=Marionette.View.extend({template:"#CleanableItem",triggers:{click:"show:popup"},onShowPopup:function(){console.log(this.model);var t={title:this.model.get("name"),content:new e.CleanableTools({id:this.model.id,unitId:this.model.get("unitId")})},i=new Popup(t);rootView.getRegion("popup").show(i)}}),e.CleanableTool=Marionette.View.extend({template:_.template("<header><%-cleaningToolName%></header>"),className:"list-group-item-light",initialize:function(){console.log(this.model)}}),e.CleanableToolEmpty=Marionette.View.extend({template:"#loading",initialize:function(){console.log(this.model)}}),t.CleanableTool=Backbone.Model.extend({defaults:function(){return{cleaningToolName:"Sponge"}}}),t.CleanableTools=Backbone.Collection.extend({model:t.CleanableTool,initialize:function(e){this.url="/back/index.php/units/"+e.unitId+"/cleanable/"+e.id}}),e.CleanableTools=Marionette.CollectionView.extend({childView:e.CleanableTool,emptyView:e.CleanableToolEmpty,initialize:function(e){this.collection=new t.CleanableTools(e),this.collection.fetch()},collectionEvents:{sync:"render"}}),e.CleanableItemEmpty=Marionette.View.extend({template:_.template("EMPTY")}),e.CleanableWrapper=Marionette.View.extend({template:"#CleanableWrapper",regions:new RegionSetter("list"),initialize:function(e){},onRender:function(){var i=this;collection=new t.Cleanable(this.options),collection.fetch(),collection.on("sync",function(t){i.getRegion("list").show(new e.Cleanable({collection:t}))})}}),e.Cleanable=Marionette.CollectionView.extend({childView:e.CleanableItem,emptyView:e.CleanableItemEmpty,initialize:function(e){}}),t.Refillable=Backbone.Collection.extend({initialize:function(e){this.url="/back/index.php/units/"+e.id+"/refillable"}}),e.RefillableItem=Marionette.View.extend({template:"#RefillableItem"}),e.RefillableItemEmpty=Marionette.View.extend({template:_.template("EMPTY")}),e.RefillableWrapper=Marionette.View.extend({template:"#RefillableWrapper",regions:new RegionSetter("list"),initialize:function(e){},onRender:function(){var i=this;collection=new t.Refillable(this.options),collection.fetch(),collection.on("sync",function(t){i.getRegion("list").show(new e.Refillable({collection:t}))})}}),e.Refillable=Marionette.CollectionView.extend({childView:e.RefillableItem,emptyView:e.RefillableItemEmpty,initialize:function(e){this.collection=e.collection}}),e.Tools=Marionette.View.extend({className:"list-group",template:"#units-tools",initialize:function(e){this.model=e.model}}),e.List=Marionette.CollectionView.extend({className:"list-group",tagName:"ul",emptyView:e.ListItemEmpty,childView:e.ListItem,initialize:function(e){this.collection=new t.List(e),this.collection.fetch()},collectionEvents:{sync:"onSync"},onChildviewOpenMap:function(e){console.log(e.model);var t=e.model;this.triggerMethod("show:marker",t)},onSync:function(){console.log(this.collection.models),this.render()},onRender:function(){}}),window.module_units={View:e,Data:t,Entry:e.Entry}}();
//# sourceMappingURL=units.js.map
