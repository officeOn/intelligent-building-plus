{"version":3,"sources":["js/zones.js"],"names":["View","Data","Backbone","extend","defaults","id","cid","name","health","url","model","Marionette","template","regions","RegionSetter","events","click [data-action=\"trigger\"]","click [data-action=\"back\"]","initialize","options","console","this","historyBack","app","navigate","trigger","onRender","_this","zonesCollection","Zones","fetch","on","show","Map","collection","showContent","e","currentTarget","dataset","showType","view","List","getRegion","map","className","onBeforeAttach","zoneId","router","onAttach","log","warn","triggerMethod","onInitMap","_this2","scrollWheelZoom","mapOptions","el","attribution","minZoom","L","tileLayer","maxZoom","continuousWorld","tms","setView","noWrap","latLngBounds","addTo","setMaxBounds","bounds","animate","_","forEach","panInsideBounds","coords","get","attributes","$","html","sample","hue","popup","myIcon","divIcon","polygon","color","random","bindPopup","latlng","lat","lng","ListItem","tagName","triggers","click","onOpenUnits","childView","window","module_zones","Entry"],"mappings":"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","file":"zones.js","sourcesContent":["(function(){\r\n\t\r\nvar View = View || {};\r\nvar Data = Data || {};\r\nvar Behaviors = Behaviors || {};\r\n\r\nData.ZoneItem = Backbone.Model.extend({\r\n\tdefaults: function() {\r\n\t\treturn {\r\n\t\t\tid: this.cid,\r\n\t\t\tname: 'No-title',\r\n\t\t\thealth: 20\r\n\t\t}\r\n\t}\r\n});\r\nData.Zones = Backbone.Collection.extend({\r\n\turl: '/back/index.php/zones',\r\n\tmodel: Data.ZoneItem,\r\n})\r\n\r\nView.Entry = Marionette.View.extend({\r\n\ttemplate: '#zones-entry',\r\n\tregions: new RegionSetter('content'),\r\n\tevents: {\r\n\t\t'click [data-action=\"trigger\"]' : 'showContent',\r\n\t\t'click [data-action=\"back\"]' : 'historyBack',\r\n\t},\r\n\tinitialize: function(options){\r\n\t\tconsole.log(this,options)\r\n\t},\r\n\thistoryBack: function() {\r\n\t\tapp.router.navigate('',{\r\n\t\t\ttrigger: true\r\n\t\t})\r\n\t},\r\n\tonRender: function() {\r\n\t\tthis.zonesCollection = new Data.Zones();\r\n\t\tthis.zonesCollection.fetch();\r\n\t\tthis.zonesCollection.on('sync', collection => {\r\n\t\t\tthis.getRegion('content').show(new View.Map({\r\n\t\t\t\tcollection: collection\r\n\t\t\t}));\r\n\t\t})\r\n\t\t\r\n\t},\r\n\tshowContent: function(e) {\r\n\t\tvar showType = e.currentTarget.dataset.id;\r\n\t\tif (showType == 'map') {\r\n\t\t\tview = new View.Map({\r\n\t\t\t\tcollection: this.zonesCollection\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tview = new View.List({\r\n\t\t\t\tcollection: this.zonesCollection\r\n\t\t\t})\r\n\t\t};\r\n\t\tthis.getRegion('content').show(view);\r\n\t}\r\n});\r\n\r\nView.Map = Marionette.View.extend({\r\n\ttemplate: '#t-map',\r\n\tmap: null,\r\n\tclassName: 'maxi-map',\r\n\tinitialize: function(options) {\r\n\t\tthis.collection = options.collection;\r\n\t},\r\n\tonBeforeAttach: function() {\r\n\t\tthis.$el.on('click', '[data-action=\"navigate\"]', (e) => {\r\n\t\t\tvar zoneId = e.currentTarget.dataset.id;\r\n\t\t\tvar url = 'zones/'+zoneId+'/units';\r\n\t\t\tapp.router.navigate(url, {\r\n\t\t\t\ttrigger: true\r\n\t\t\t})\r\n\t\t})\r\n\t},\r\n\tonAttach: function() {\r\n\t\tconsole.log(this.collection);\r\n\t\tif (typeof L !== 'undefined') {\r\n\t\t\tconsole.warn(this.map);\r\n\t\t\tif (this.map != null) {\r\n\t\t\t\tthis.map.remove();\r\n\t\t\t}\r\n\t\t\tthis.triggerMethod('init:map')\r\n\t\t}\r\n\t},\r\n\tonInitMap: function() {\r\n\t\tvar mapOptions = {\r\n\t\t\tscrollWheelZoom: false,\r\n\t\t}\r\n\t\tthis.map = L.map(this.el, mapOptions);\r\n\t\tL.tileLayer('http://85.188.8.254/back/IB_floorplan_72.53mx72.53m/{z}/{x}/{y}.png', {\r\n\t\t\tattribution: '&copy; <a target=\"_blank\" href=\"http://tieto.com\">Tieto</a>',\r\n\t\t\tminZoom: 1,\r\n\t\t\tmaxZoom: 6,\r\n\t\t\tcontinuousWorld: false,\r\n\t\t\ttms: true,\r\n\t\t\tnoWrap: true\r\n\t\t}).addTo(this.map);\r\n\t\tthis.map.setView([0,-100], 1);\r\n\t\tvar bounds = L.latLngBounds([[-180, -180], [180, 180]]);\r\n\t\tthis.map.setMaxBounds(bounds);\r\n\t\tthis.map.on('drag', () => {\r\n\t\t\tthis.map.panInsideBounds(bounds, { animate: true });\r\n\t\t});\r\n\r\n\t\t_.forEach(this.collection.models, model => {\r\n\r\n\t\t\tvar coords = model.get('coordinates');\r\n\t\t\tif (coords) {\r\n\t\t\t\tdataset = model.attributes;\r\n\t\t\t\tvar popup = _.template($('#t-polygon-popup').html())(dataset);\r\n\t\t\t\tvar classPostfix = _.sample(['marker-success','marker-warning','marker-danger'])\r\n\t\t\t\tvar myIcon = L.divIcon({\r\n\t\t\t\t\tclassName: 'marker '+classPostfix\r\n\t\t\t\t});\r\n\t\t\t\tvar hue = _.random(10,100);\r\n\t\t\t\tvar polygon = L\r\n\t\t\t\t\t.polygon(coords, {\r\n\t\t\t\t\t\tcolor: 'hsl('+hue+',70%,50%)'\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.bindPopup(popup)\r\n\t\t\t\tthis.map.addLayer(polygon);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.map.on('click', function(e) {\r\n\t\t\tconsole.log([e.latlng.lat,e.latlng.lng]);    \r\n\t\t});\r\n\t\t// this.map.addLayer(popup);\r\n\t},\r\n})\r\n\r\nView.ListItem = Marionette.View.extend({\r\n\ttemplate: '#zones-listItem',\r\n\tclassName: 'list-group-item-light',\r\n\ttagName: 'li',\r\n\tregions: new RegionSetter('map','tools'),\r\n\tui: {\r\n\t},\r\n\ttriggers: {\r\n\t\t'click' : 'open:units',\r\n \t},\r\n \tonOpenUnits: function() {\r\n \t\tzoneId = this.model.id;\r\n\t\tvar url = 'zones/'+zoneId+'/units';\r\n\t\tapp.router.navigate(url, {\r\n\t\t\ttrigger: true\r\n\t\t})\r\n \t}\r\n \t\r\n});\r\n\r\nView.List = Marionette.CollectionView.extend({\r\n\tclassName: 'list-group',\r\n\ttagName: 'ul',\r\n\tchildView: View.ListItem,\r\n\tinitialize: function(options) {\r\n\t\tthis.collection = options.collection\r\n\t},\r\n\tonRender: function() {\r\n\t}\r\n})\r\n\r\n\r\n\r\n\r\nwindow.module_zones = {\r\n\tView: View,\r\n\tData: Data,\r\n\tEntry: View.Entry,\r\n}\r\nconsole.log(window['module_zones'])\r\n}());\r\n"]}