{"version":3,"sources":["js/user.js"],"names":["View","Data","Backbone","extend","defaults","id","cid","name","health","url","model","Marionette","template","regions","RegionSetter","className","onRender","this","getRegion","show","map","initialize","options","onAttach","console","L","remove","triggerMethod","onInitMap","_this","mapOptions","scrollWheelZoom","el","tileLayer","attribution","minZoom","maxZoom","continuousWorld","tms","dataset","attributes","coords","get","_","html","popup","classPostfix","sample","latLngBounds","setMaxBounds","bounds","animate","marker","panInsideBounds","icon","bindPopup","addLayer","setView","rating","tagName","fetch","ui","star","onStartCheck","_this2","getUI","removeClass","$","ajax","data","dataType","addClass","error","alert","always","onSync","render","modelEvents","sync","CollectionView","childView","Action","collection","Collection","title","description","view","models","window","module_user","Entry"],"mappings":"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","file":"user.js","sourcesContent":["(function(){\r\n\t\r\nvar View = View || {};\r\nvar Data = Data || {};\r\nvar Behaviors = Behaviors || {};\r\n\r\nData.ListItem = Backbone.Model.extend({\r\n\tdefaults: function() {\r\n\t\treturn {\r\n\t\t\tid: this.cid,\r\n\t\t\tname: 'No-title',\r\n\t\t\thealth: 20\r\n\t\t}\r\n\t}\r\n});\r\nData.List = Backbone.Collection.extend({\r\n\turl: '/back/index.php/health',\r\n\tmodel: Data.ListItem,\r\n})\r\n\r\nView.Entry = Marionette.View.extend({\r\n\ttemplate: '#user-entry',\r\n\tregions: new RegionSetter('about', 'actions'),\r\n\tclassName: 'user',\r\n\tonRender: function() {\r\n\t\tthis.getRegion('actions').show(new View.Actions());\r\n\t\tthis.getRegion('about').show(new View.About());\r\n\t},\r\n});\r\n\r\nView.Map = Marionette.View.extend({\r\n\ttemplate: '#t-map',\r\n\tmap: null,\r\n\tclassName: 'mini-map',\r\n\tinitialize: function(options) {\r\n\t\tthis.model = options.model;\r\n\t},\r\n\tonAttach: function() {\r\n\t\tconsole.log(this.model);\r\n\t\tif (typeof L !== 'undefined') {\r\n\t\t\tconsole.warn(this.map);\r\n\t\t\tif (this.map != null) {\r\n\t\t\t\tthis.map.remove();\r\n\t\t\t}\r\n\t\t\tthis.triggerMethod('init:map')\r\n\t\t}\r\n\t},\r\n\tonInitMap: function() {\r\n\t\tvar mapOptions = {\r\n\t\t\tscrollWheelZoom: false,\r\n\t\t}\r\n\t\tthis.map = L.map(this.el, mapOptions);\r\n\t\tL.tileLayer('http://85.188.8.254/back/IB_floorplan_72.53mx72.53m/{z}/{x}/{y}.png', {\r\n\t\t\tattribution: '&copy; <a target=\"_blank\" href=\"http://tieto.com\">Tieto</a>',\r\n\t\t\tminZoom: 1,\r\n\t\t\tmaxZoom: 6,\r\n\t\t\tcontinuousWorld: false,\r\n\t\t\ttms: true,\r\n\t\t\tnoWrap: true\r\n\t\t}).addTo(this.map);\r\n\r\n\t\t\tdataset = this.model.attributes;\r\n\t\t\tvar coords = this.model.get('coordinates');\r\n\t\t\tvar popup = _.template($('#t-list-map-popup').html())(dataset);\r\n\t\t\tvar classPostfix = _.sample(['marker-success','marker-warning','marker-danger'])\r\n\t\t\tvar myIcon = L.divIcon({\r\n\t\t\t\tclassName: 'marker '+classPostfix\r\n\t\t\t});\r\n\t\t\tvar bounds = L.latLngBounds([[-180, -180], [180, 180]]);\r\n\t\t\tthis.map.setMaxBounds(bounds);\r\n\t\t\tthis.map.on('drag', () => {\r\n\t\t\t\tthis.map.panInsideBounds(bounds, { animate: true });\r\n\t\t\t});\r\n\t\t\tvar marker = L\r\n\t\t\t\t.marker(coords, {\r\n\t\t\t\t\ticon: myIcon,\r\n\t\t\t\t})\r\n\t\t\t\t.bindPopup(popup)\r\n\t\r\n\t\tthis.map.addLayer(marker);\r\n\t\tthis.map.setView(coords, 2);\r\n\t},\r\n});\r\nData.About = Backbone.Model.extend({\r\n\turl: '/back/index.php/rating/1',\r\n\tdefaults: function() {\r\n\t\treturn {\r\n\t\t\trating: 3,\r\n\t\t\tname: 'Nicole',\r\n\r\n\t\t}\r\n\t}\r\n})\r\nView.About = Marionette.View.extend({\r\n\ttagName: 'div',\r\n\ttemplate: '#loading',\r\n\tclassName: 'user-top',\r\n\tinitialize: function(options) {\r\n\t\tthis.model = new Data.About();\r\n\t\tthis.model.fetch();\r\n\t},\r\n\tui: {\r\n\t\t'star' : '.glyphicon-star.super'\r\n\t},\r\n\tonRender: function() {\r\n\t\tthis.template = '#user-about';\r\n\t},\r\n\tonStartCheck: function() {\r\n\t\tthis.getUI('star').removeClass('go');\r\n\t\t$.ajax({\r\n\t\t\turl: this.model.url+'/long',\r\n\t\t\tdataType: 'json',\r\n\t\t\tsuccess: (data) => {\r\n\t\t\t\tif (data.delivered == 1) {\r\n\r\n\t\t\t\t}\r\n\t\t\t\tthis.getUI('star').addClass('go');\r\n\t\t\t\t// _.delay(()=>{\r\n\t\t\t\t// \tthis.triggerMethod('start:check')\r\n\t\t\t\t// }, 5000)\r\n\t\t\t},\r\n\t\t\terror: function() {\r\n\t\t\t\talert('Sorry, we can not reach the server')\r\n\t\t\t},\r\n\t\t\talways: (data) => {\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tonSync: function() {\r\n\t\tthis.render();\r\n\t\tthis.triggerMethod('start:check');\r\n\t},\r\n\tmodelEvents: {\r\n\t\t'sync' : 'onSync'\r\n\t},\r\n\r\n});\r\nView.Action = Marionette.View.extend({\r\n\tclassName: 'list-group-item list-group-item-user',\r\n\ttagName: 'li',\r\n\ttemplate: '#user-action'\r\n});\r\nView.Actions = Marionette.CollectionView.extend({\r\n\tclassName: 'list-group',\r\n\ttagName: 'ul',\r\n\tchildView: View.Action,\r\n\tinitialize: function(options) {\r\n\t\tthis.collection = new Backbone.Collection([{\r\n\t\t\tid: 1,\r\n\t\t\ttitle: 'Report an issue',\r\n\t\t\tdescription: 'Pick from a list...',\r\n\t\t\ticon: 'warning-sign'\r\n\t\t},{\r\n\t\t\tid: 2,\r\n\t\t\ttitle: 'Need tech support',\r\n\t\t\tdescription: 'Choose a ... ',\r\n\t\t\ticon: 'wrench'\r\n\t\t},{\r\n\t\t\tid: 3,\r\n\t\t\ttitle: 'Order a lunch',\r\n\t\t\tdescription: 'Favorite cafeteria is <b>Floor 4, \"Eat me!\"</b>',\r\n\t\t\ticon: 'cutlery'\r\n\t\t},{\r\n\t\t\tid: 4,\r\n\t\t\ttitle: 'Vote up for ...',\r\n\t\t\tdescription: null,\r\n\t\t\ticon: 'thumbs-up'\r\n\t\t},{\r\n\t\t\tid: 5,\r\n\t\t\ttitle: 'Rate clealiness',\r\n\t\t\tdescription: 'A <b>toilet</b> around your geo-position',\r\n\t\t\ticon: 'star'\r\n\t\t},])\r\n\t},\r\n\tonChildviewOpenMap: function(view) {\r\n\t\tconsole.log(view.model);\r\n\t\tvar model = view.model;\r\n\t\tthis.triggerMethod('show:marker',model);\r\n\t},\r\n\tonSync: function() {\r\n\t\tconsole.log(this.collection.models);\r\n\t\tthis.render();\r\n\t},\r\n\tonRender: function() {\r\n\t},\r\n})\r\n\r\n\r\n\r\n\r\nwindow.module_user = {\r\n\tView: View,\r\n\tData: Data,\r\n\tEntry: View.Entry,\r\n}\r\n}());\r\n"]}